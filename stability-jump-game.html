<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stability Jump Game</title>
  <style>
    canvas {
      border: 1px solid #000;
      display: block;
      margin: 20px auto;
    }
    body {
      font-family: sans-serif;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Stability Jump Game</h1>
  <p>Use Arrow Keys or W/S to Move</p>
  <canvas id="gameCanvas" width="400" height="600"></canvas>
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.umd.min.js"></script>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let playerY = 300;
    const playerX = 200;
    const playerSize = 20;
    const coinSize = 10;
    let coins = [];

    const generateCoin = () => {
      const y = Math.floor(Math.random() * canvas.height);
      coins.push({ x: Math.random() * canvas.width, y, collected: false });
    };

    setInterval(generateCoin, 2000);

    const drawPlayer = () => {
      ctx.fillStyle = "blue";
      ctx.fillRect(playerX, playerY, playerSize, playerSize);
    };

    const drawCoins = () => {
      ctx.fillStyle = "gold";
      coins.forEach((coin) => {
        if (!coin.collected) ctx.fillRect(coin.x, coin.y, coinSize, coinSize);
      });
    };

    const simulateCoinPickup = () => {
      coins.forEach((coin) => {
        if (
          !coin.collected &&
          coin.x < playerX + playerSize &&
          coin.x + coinSize > playerX &&
          coin.y < playerY + playerSize &&
          coin.y + coinSize > playerY
        ) {
          coin.collected = true;
          mintCoinToTBA();
        }
      });
    };

    const loop = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPlayer();
      drawCoins();
      simulateCoinPickup();
      requestAnimationFrame(loop);
    };

    loop();

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp" || e.key === "w") {
        playerY -= 20;
      } else if (e.key === "ArrowDown" || e.key === "s") {
        playerY += 20;
      }
    });

    async function mintCoinToTBA() {
      try {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();
        const contract = new ethers.Contract(
          "0x1060ac7973c7ff2f07900BE60c901F423a507Bb9",
          [
            "function mintToTBA(address player, uint256 id) public"
          ],
          signer
        );
        const address = await signer.getAddress();
        await contract.mintToTBA(address, 0);
        console.log("Minted coin to TBA");
      } catch (error) {
        console.error("Minting error:", error);
      }
    }
  </script>
</body>
</html>
